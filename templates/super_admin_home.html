<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Super Admin Home - Eastern Province Cement Co.</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-neutral-100 min-h-screen flex flex-col font-sans text-gray-800">

  {% include 'header.html' %}

  <main class="flex-grow container mx-auto p-6">

    <header class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
      <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight">SuperAdmin Dashboard</h1>
      <div class="text-lg font-medium text-gray-700">
        Welcome, <span class="text-indigo-600">{{ user.username }}</span>
      </div>
    </header>

    <form method="get" action="{{ url_for('superadmin_home') }}" class="flex flex-wrap gap-4 mb-10 items-center">
      <input
        type="search"
        name="search"
        placeholder="Search Admins & Trainees..."
        value="{{ request.args.get('search', '') }}"
        class="flex-grow min-w-[250px] px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
        aria-label="Search Admins and Trainees"
      />
      <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-md font-semibold hover:bg-indigo-700 transition">
        Search
      </button>
      <a href="{{ url_for('create_admin') }}" class="px-6 py-3 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 transition whitespace-nowrap">
        Create Admin
      </a>
      <a href="{{ url_for('export_data') }}" class="px-6 py-3 bg-gray-600 text-white rounded-md font-semibold hover:bg-gray-700 transition whitespace-nowrap">
        Export CSV
      </a>
    </form>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

      <!-- Admins List -->
      <section aria-label="Admins List" class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-semibold mb-6 border-b pb-2">Admins</h2>
        <ul class="space-y-3 max-h-[400px] overflow-y-auto">
          {% for admin in admins %}
            <li class="flex justify-between items-center border-b border-gray-200 pb-2">
              <a href="#" onclick="showUserModal('{{ admin.username }}', '{{ admin.id }}', 'Admin')" class="text-indigo-600 hover:underline font-medium">
                {{ admin.username }}
              </a>
              <form method="post" action="{{ url_for('delete_admin', admin_id=admin.id) }}" onsubmit="return confirm('Delete admin {{ admin.username }}?');">
                <button type="submit" class="text-red-600 hover:text-red-800 font-semibold">Delete</button>
              </form>
            </li>
          {% else %}
            <li class="text-gray-500 italic">No admins found.</li>
          {% endfor %}
        </ul>
      </section>

      <!-- Trainees List -->
      <section aria-label="Trainees List" class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-semibold mb-6 border-b pb-2">Trainees</h2>
        <ul class="space-y-3 max-h-[400px] overflow-y-auto">
          {% for trainee in trainees %}
            <li>
              <a href="#" onclick="showUserModal('{{ trainee.username }}', '{{ trainee.id }}', 'Trainee')" class="text-indigo-600 hover:underline font-medium">
                {{ trainee.username }}
              </a>
            </li>
          {% else %}
            <li class="text-gray-500 italic">No trainees found.</li>
          {% endfor %}
        </ul>
      </section>

    </div>

  </main>

  <!-- Profile Modal -->
  <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 hidden">
    <div class="bg-white rounded-xl w-full max-w-lg p-8 relative shadow-2xl max-h-[90vh] overflow-y-auto">
      <button onclick="toggleProfileModal()" aria-label="Close modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 text-3xl font-bold">&times;</button>
      <h2 class="text-3xl font-extrabold mb-6" id="userProfileTitle">Profile</h2>
      <div class="space-y-4 text-lg">
        <p><strong>Username:</strong> <span id="profileUsername" class="text-indigo-700"></span></p>
        <p><strong>ID:</strong> <span id="profileID"></span></p>
        <p><strong>Role:</strong> <span id="profileRole"></span></p>

        <div id="extraTraineeFields" class="space-y-3">
          <p><strong>Email:</strong> <span id="profileEmail">—</span></p>
          <p><strong>Phone:</strong> <span id="profilePhone">—</span></p>
          <p><strong>University:</strong> <span id="profileUniversity">—</span></p>
          <p><strong>Created At:</strong> <span id="profileCreated">—</span></p>

          <div class="mt-6">
            <h3 class="font-semibold text-gray-700 mb-3">Submitted Reports:</h3>
            <ul id="profileReports" class="list-disc list-inside text-gray-800 space-y-2 max-h-56 overflow-y-auto">
              <!-- JS injects report items here -->
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function showUserModal(username, id, role) {
      if (role === 'Trainee') {
        fetch(`/admin/trainee-info/${id}`)
          .then(response => response.json())
          .then(data => {
            document.getElementById('userProfileTitle').textContent = 'Trainee Profile';
            document.getElementById('profileUsername').textContent = data.username;
            document.getElementById('profileID').textContent = id;
            document.getElementById('profileRole').textContent = role;

            document.getElementById('profileEmail').textContent = data.email || '—';
            document.getElementById('profilePhone').textContent = data.phone || '—';
            document.getElementById('profileUniversity').textContent = data.university || '—';
            document.getElementById('profileCreated').textContent = data.created_at || '—';

            const reportList = document.getElementById('profileReports');
            reportList.innerHTML = '';
            if (data.reports.length > 0) {
              data.reports.forEach(r => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="/download_report/${r.id}" class="text-indigo-600 hover:underline" target="_blank" rel="noopener noreferrer">${r.filename}</a> — ${r.title}`;
                reportList.appendChild(li);
              });
            } else {
              reportList.innerHTML = '<li class="text-gray-500 italic">No reports submitted</li>';
            }

            document.getElementById('extraTraineeFields').style.display = 'block';
            document.getElementById('profileModal').classList.remove('hidden');
          });
      } else {
        document.getElementById('userProfileTitle').textContent = role + ' Profile';
        document.getElementById('profileUsername').textContent = username;
        document.getElementById('profileID').textContent = id;
        document.getElementById('profileRole').textContent = role;

        document.getElementById('extraTraineeFields').style.display = 'none';
        document.getElementById('profileModal').classList.remove('hidden');
      }
    }

    function toggleProfileModal() {
      document.getElementById('profileModal').classList.add('hidden');
      document.getElementById('extraTraineeFields').style.display = 'block';
    }
  </script>

</body>
</html>
